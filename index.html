<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自动驾驶合作实验</title>
    <link href="css/tailwind-2.2.19.min.css" rel="stylesheet">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
        }

        #monitor-area {
            width: 100vh;
            max-width: 100%;
            height: 100vh;
        }

        #page {
            text-indent: 2.5rem;
        }
    </style>
</head>

<body>
    <div id="debug" class="fixed m-1 p-2 bg-gray-200 rounded-xl z-50 hidden">
        <button class="px-1.5 my-0.5 bg-black rounded-md bg-opacity-10 hover:bg-opacity-20"
            onclick="toggleDialog()">开关决策框</button>
        <br>
        <button class="px-1.5 my-0.5 bg-black rounded-md bg-opacity-10 hover:bg-opacity-20"
            onclick="app.pause()">暂停</button>
    </div>
    <div id="app" class="h-full w-full overflow-hidden bg-gray-50">
        <div id="monitor-area" class="relative mx-auto select-none">
            <div id="monitor" class="absolute inset-2 p-5 bg-gray-700 ring-4 ring-gray-400 rounded-3xl">
                <div id="page" class="absolute inset-5 bg-gray-100 text-xl flex-col
                        transition-opacity duration-200 ease-in-out opacity-100 z-50">
                    <div class="flex w-full h-4/5 p-8">
                        <div id="page-1" class="my-auto">
                            <p>
                                在道路车辆高峰期，十字路口会发生直行车辆与转弯车辆拥堵现象，虽然我国交规要求转弯车辆应避让直行车辆，但仍可能发生转弯车辆会抢先行驶的情况。在这种情况下，你会选择让行，还是选择继续行驶呢？
                            </p>
                            <p>
                                本实验中你将作为自动驾驶汽车的车主，朝十字路口方向直行，十字路口对面有一辆即将左转的车辆，自动驾驶汽车可对对方车辆进行社会价值取向的检测（亲社会、亲自我、无），并自行做出直行或让行的决策，你可以对该决策进行修改。
                            </p>
                        </div>
                        <div id="page-2" class="my-auto hidden">
                            <p>
                                本实验中，你将与左转车辆车主进行是否让行的博弈，实验绩效将与你的得分相关。在十字路口：
                            </p>
                            <p>若你选择直行，对方选择左转，则两车均无法顺利通过；</p>
                            <p>若你选择直行，对方选择等待，则你可以顺利通过；</p>
                            <p>若你选择等待，对方选择左转，则对方可顺利通过；</p>
                            <p>若你选择等待，对方选择等待，则会造成道路资源浪费。</p>
                            <p>
                                得分表如下：
                                <table class="mx-auto border-collapse border-2 border-blue-500 bg-blue-50 text-center">
                                    <tbody>
                                        <tr class="bg-blue-100">
                                            <td class="border-2 border-blue-500 w-16"></td>
                                            <td class="border-2 border-blue-500 w-20">左转</td>
                                            <td class="border-2 border-blue-500 w-20">等待</td>
                                        </tr>
                                        <tr>
                                            <td class="border-2 border-blue-500 bg-blue-100">直行</td>
                                            <td class="border-2 border-blue-500">(-2,-2)</td>
                                            <td class="border-2 border-blue-500">(2,0)</td>
                                        </tr>
                                        <tr>
                                            <td class="border-2 border-blue-500 bg-blue-100">等待</td>
                                            <td class="border-2 border-blue-500">(0,2)</td>
                                            <td class="border-2 border-blue-500">(-1,-1)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </p>
                        </div>
                        <div id="page-3" class="my-auto hidden">
                            <p>
                                实验中，实验程序中的路况界面为你驾驶的自动驾驶汽车车内显示屏界面。为控制实验变量，实验程序中将不展示路面上的其他车辆，只保留我方直行车辆及对方左转车辆。
                            </p>
                            <p>
                                检测到的对方社会价值取向标注在屏幕右上角，并自动做出直行或等待的决策显示在屏幕上，此时你可以对系统决策进行更改，若到达路口时未做出更改，则车辆按照系统决策行动。
                            </p>
                        </div>
                        <div id="page-4" class="my-auto hidden">
                            <p>
                                为确保大家对实验的理解，现将进行预实验，预实验默认进行五轮次，如在预实验过程中遇到不解，可返回查看实验说明直至理解实验内容，点击按钮进入正式实验。
                            </p>
                            <button class="absolute left-1/4 bottom-12 w-20 h-10 bg-gray-300 rounded-lg"
                                onclick="back()">返回</button>
                        </div>
                    </div>
                    <button class="absolute left-1/2 bottom-12 transform -translate-x-1/2 w-32 h-10 bg-gray-300 rounded-lg"
                        onclick="next()">下一页</button>
                </div>
                <div id="render" class="absolute inset-5 bg-gray-400">
                    <canvas></canvas>
                </div>
                <div id="cut"
                    class="absolute inset-5 flex bg-gray-100 transition-opacity duration-200 ease-in-out opacity-0">
                    <span id="cut-text" class="m-auto text-gray-700 text-4xl">
                        Round: <span id="cut-round">1</span>/20
                    </span>
                </div>
                <div id="tip" class="absolute top-5 right-7 flex-col">
                    <div class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white">
                        <span class="my-auto ml-2">Score:</span>
                        <span id="tip-score" class="my-auto ml-1.5">0</span>
                    </div>
                    <div class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white">
                        <span class="my-auto ml-2">Round:</span>
                        <span id="tip-round" class="my-auto ml-1.5">1</span>
                        <span class="my-auto">/20</span>
                    </div>
                    <div id="tip-social" class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white hidden">
                        <span class="m-auto text-green-300">亲社会</span>
                    </div>
                    <div id="tip-self" class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white hidden">
                        <span class="m-auto text-red-300">亲自我</span>
                    </div>
                    <div id="tip-none" class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white hidden">
                        <span class="m-auto">无倾向</span>
                    </div>
                </div>
                <div id="dialog-area" class="absolute bottom-5 inset-x-5 transition-all delay-200 invisible">
                    <div id="dialog" class="mx-auto mb-8 w-80 max-w-full py-4 px-0 overflow-hidden align-middle bg-white shadow-xl rounded-2xl 
                        transition aduration-200 ease-in-out transform scale-95 opacity-0">
                        <div id="dialog-sign"
                            class="absolute -mt-1 w-full transition duration-500 ease-in-out transform scale-95 opacity-10">
                            <svg id="move-sign" xmlns="http://www.w3.org/2000/svg"
                                class="h-24 w-24 mx-auto text-gray-700 transition-opacity" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
                                    d="M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z" />
                            </svg>
                            <svg id="wait-sign" xmlns="http://www.w3.org/2000/svg"
                                class="h-24 w-24 mx-auto text-gray-700 transition-opacity hidden" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
                                    d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                            </svg>
                        </div>
                        <div id="dialog-text" class="transition-opacity ease-in-out opacity-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-1" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <h3 class="text-center text-lg leading-6 text-gray-900">
                                检测到对方车辆即将左转<br>
                                我方车辆默认<b><span id="auto-decition-text">等待</span></b>，是否更改？
                            </h3>
                        </div>
                        <div id="dialog-btns" class="mt-3 flex px-6">
                            <button id="move-btn" type="button" class="mx-auto rounded-md inline-flex justify-center sm:px-8 px-6 py-1 text-lg text-blue-900
                                    transition-colors duration-200 ease-in-out bg-blue-100 hover:bg-blue-200"
                                onclick="clickMove();exp.changeStop(false);">
                                <div id="move-btn-svg" class="my-auto -ml-2 mr-2 w-6 flex hidden">
                                    <svg class="btn-doing animate-spin h-5 w-5 m-auto text-blue-500"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-50" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-100" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <svg class="btn-done h-6 w-6 m-auto text-blue-500 hidden"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                直行
                            </button>
                            <button id="wait-btn" type="button" class="mx-auto rounded-md inline-flex justify-center sm:px-8 px-6 py-1 text-lg text-blue-900
                                    transition-colors duration-200 ease-in-out bg-blue-100 hover:bg-blue-200"
                                onclick="clickWait();exp.changeStop(true);">
                                <div id="wait-btn-svg" class="my-auto -ml-2 mr-2 w-6 flex">
                                    <svg class="btn-doing animate-spin h-5 w-5 m-auto text-blue-500"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-50" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-100" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <svg class="btn-done h-6 w-6 m-auto text-blue-500 hidden"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                等待
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/lib/jquery-3.6.0.min.js"></script>
    <script src="js/lib/three.js"></script>
    <script src="js/load.js"></script>
    <script src="js/app.js"></script>
    <script src="js/main.js"></script>
    <script>
        const debug = false;
        if (debug) {
            $('#debug').removeClass('hidden');

            // $('#cut').toggleClass('opacity-0 opacity-100');
            // toggleDialog();
            // $('#cut-text').toggleClass('hidden');
            // $('#cut').toggleClass('opacity-0 opacity-100');
        }
        app.pause();

        function toggleDialog(open) {
            if (void 0 == open) {
                $('#dialog').toggleClass('scale-95 opacity-0 scale-100 opacity-100');
                $('#dialog-area').toggleClass('delay-200 invisible');
            } else if (open) {
                $('#dialog').removeClass('scale-95 opacity-0');
                $('#dialog').addClass('scale-100 opacity-100');
                $('#dialog-area').removeClass('delay-200 invisible');
            } else {
                $('#dialog').addClass('scale-95 opacity-0');
                $('#dialog').removeClass('scale-100 opacity-100');
                $('#dialog-area').addClass('delay-200 invisible');
            }
        }

        function toggleCut(time) {
            $('#cut').toggleClass('opacity-0 opacity-100');
            if (void 0 != time)
                setTimeout(() => { $('#cut').toggleClass('opacity-0 opacity-100'); }, time);
        }

        function setScore(score) {
            $('#tip-score')[0].innerHTML = score;
        }
        function getScore() {
            return parseInt($('#tip-score')[0].innerHTML);
        }
        function addScore(val) {
            setScore(getScore() + val);
        }
        function setRound(round) {
            if (round > 20) round -= 20;
            $('#tip-round')[0].innerHTML = round;
            $('#cut-round')[0].innerHTML = round;
        }
        function getRound() {
            return parseInt($('#tip-round')[0].innerHTML);
        }
        function addRound() {
            setRound(getRound() + 1);
        }

        function clickMove() {
            $('#move-btn-svg').removeClass('hidden');
            $('#wait-btn-svg').addClass('hidden');
            $('#move-sign').removeClass('hidden');
            $('#wait-sign').addClass('hidden');
        }
        function clickWait() {
            $('#move-btn-svg').addClass('hidden');
            $('#wait-btn-svg').removeClass('hidden');
            $('#move-sign').addClass('hidden');
            $('#wait-sign').removeClass('hidden');
        }

        function toggleSign() {
            $('#dialog-sign').toggleClass('opacity-10 scale-80 opacity-100 scale-100');
            $('#dialog-text').toggleClass('opacity-0 opacity-100');
        }

        var currentPage = 1;
        function next(){
            $('#page-'+currentPage++).addClass('hidden');
            $('#page-'+currentPage).removeClass('hidden');
            if (currentPage>4){
                $('#page').addClass('hidden');
                app.pause();
                exp.setExp();
            }
        }
        function back(){
            $('#page-'+currentPage).addClass('hidden');
            currentPage = 1;
            $('#page-'+currentPage).removeClass('hidden');
        }
    </script>
</body>

</html>