<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自动驾驶合作实验</title>
    <link href="css/tailwind-2.2.19.min.css" rel="stylesheet">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
        }

        #monitor-area {
            width: 100vh;
            max-width: 100%;
            height: 100vh;
        }

        #page-area p {
            text-indent: 2.5rem;
        }

        #page-area h1 {
            text-indent: 0rem;
            text-align: center;
            font-size: x-large;
            font-weight: bold;
            line-height: 4rem;
        }

        #progress:hover #prog-text {
            opacity: 100%;
        }
        
        #svo-table .grid-cols-def {
            grid-template-columns: 1.5fr repeat(9, minmax(0, 1fr));
        }
        #svo-table .svo-row>div {
            cursor: pointer;
            position: relative;
        }
        #svo-table .svo-row>div::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            height: 0.25rem;
            width: 0.35rem;
            max-width: 100%;
            background-color: rgb(104, 179, 223);
            border-radius: 9999px;

            transition-property: width;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }
        #svo-table .svo-row>div.selected::before {
            width: 1.75rem;
        }
    </style>
</head>

<body>
    <div id="debug" class="fixed m-1 p-2 bg-gray-200 rounded-xl z-50 hidden">
        <button class="px-1.5 my-0.5 bg-black rounded-md bg-opacity-10 hover:bg-opacity-20"
            onclick="toggleDialog()">开关决策框</button>
        <br>
        <button class="px-1.5 my-0.5 bg-black rounded-md bg-opacity-10 hover:bg-opacity-20"
            onclick="app.pause()">暂停</button>
    </div>
    <div id="app" class="h-full w-full overflow-hidden bg-gray-50">
        <div id="monitor-area" class="relative mx-auto select-none">
            <div id="monitor" class="absolute inset-2 p-5 bg-gray-700 ring-4 ring-gray-400 rounded-3xl">
                <div id="page-area" class="absolute inset-5 bg-gray-100 text-xl flex-col z-50
                        transition-opacity duration-500 ease-in-out opacity-100">
                    <button id="next-btn"
                        class="absolute left-1/2 bottom-12 transform -translate-x-1/2 w-32 h-10 bg-gray-300 rounded-lg"
                        onclick="next()">下一页</button>
                    <div id="pages" class="h-4/5 flex p-8 overflow-x-hidden"
                        style="overflow-y: overlay;">
                        <div id="page-id" class="page m-auto hidden">
                            <h1>自动驾驶合作实验</h1>
                            <br>
                            <div class="flex justify-center m-auto">
                                <span class="my-auto">请输入实验编号：</span>
                                <input id="id-input" type="text"
                                    class="w-32 h-8 px-2 py-1 text-base leading-3 border rounded-md">
                            </div>
                            <br>
                            <span class="my-auto">
                                注意，完成实验前请勿刷新网页，否则将丢失所有进度
                            </span>
                        </div>
                        <div id="page-svo" class="page absolute inset-0 p-8 m-auto bg-gray-100 hidden" style="overflow-y: overlay;">
                            <h1>SVO测试</h1>
                            <p>
                                本页面将对你的社会价值取向进行测量。在这个任务中，你被随机地与另一个人配对，我们称他为“其他人”。这个人是你不认识的人，你们将保持匿名，你所有的选择都是完全保密的。
                            </p>
                            <p>
                                <b>你要做一系列的决定，在你和这个人之间分配资源。</b>
                            </p>
                            <div id="svo-table" class="w-full mt-2 bg-blue-50 text-lg">
                                <div class="mt-1 mx-2 px-3 border-2 rounded-lg border-blue-500 bg-blue-50 text-center">
                                    <div class="grid grid-cols-def gap-x-2">
                                        <div class="label whitespace-nowrap"> <div>你得到</div> <div>其他人</div> </div>
                                        <div id="svo-row-0" class="svo-row col-span-9 grid grid-cols-9">
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div class="selected"> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 mx-2 px-3 border-2 rounded-lg border-blue-500 bg-blue-50 text-center">
                                    <div class="grid grid-cols-def gap-x-2">
                                        <div class="label whitespace-nowrap"> <div>你得到</div> <div>其他人</div> </div>
                                        <div id="svo-row-1" class="svo-row col-span-9 grid grid-cols-9">
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div class="selected"> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 mx-2 px-3 border-2 rounded-lg border-blue-500 bg-blue-50 text-center">
                                    <div class="grid grid-cols-def gap-x-2">
                                        <div class="label whitespace-nowrap"> <div>你得到</div> <div>其他人</div> </div>
                                        <div id="svo-row-2" class="svo-row col-span-9 grid grid-cols-9">
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div class="selected"> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 mx-2 px-3 border-2 rounded-lg border-blue-500 bg-blue-50 text-center">
                                    <div class="grid grid-cols-def gap-x-2">
                                        <div class="label whitespace-nowrap"> <div>你得到</div> <div>其他人</div> </div>
                                        <div id="svo-row-3" class="svo-row col-span-9 grid grid-cols-9">
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div class="selected"> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 mx-2 px-3 border-2 rounded-lg border-blue-500 bg-blue-50 text-center">
                                    <div class="grid grid-cols-def gap-x-2">
                                        <div class="label whitespace-nowrap"> <div>你得到</div> <div>其他人</div> </div>
                                        <div id="svo-row-4" class="svo-row col-span-9 grid grid-cols-9">
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div class="selected"> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 mx-2 px-3 border-2 rounded-lg border-blue-500 bg-blue-50 text-center">
                                    <div class="grid grid-cols-def gap-x-2">
                                        <div class="label whitespace-nowrap"> <div>你得到</div> <div>其他人</div> </div>
                                        <div id="svo-row-5" class="svo-row col-span-9 grid grid-cols-9">
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div class="selected"> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                            <div> <div>85</div> <div>85</div> </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="sticky top-full w-full mt-6 mb-4 flex">
                                <button class="mx-auto w-32 h-10 bg-gray-300 rounded-lg"
                                    onclick="next()">下一页</button>
                            </div>
                        </div>
                        <div id="page-back" class="page m-auto hidden">
                            <h1>实验背景</h1>
                            <p>
                                在道路车辆高峰期，十字路口会发生直行车辆与转弯车辆拥堵现象，虽然我国交规要求转弯车辆应避让直行车辆，但仍可能发生转弯车辆会抢先行驶的情况。在这种情况下，你会选择让行，还是选择继续行驶呢？
                            </p>
                            <p>
                                本实验中你将作为自动驾驶汽车的车主，朝十字路口方向直行，十字路口对面有一辆即将左转的车辆。自动驾驶汽车可以检测对方的社会价值取向（亲社会、亲自我、无信息），并自行做出直行或让行的决策，你可以对该决策进行修改。需要注意的是，社会价值取向只表示对方的一种倾向，并不与其是否让行相对应，如亲社会的汽车并不总是让行。
                            </p>
                        </div>
                        <div id="page-info-1" class="page m-auto hidden">
                            <h1>实验说明</h1>
                            <p>
                                本实验中，你将与左转车辆车主进行是否让行的博弈，实验绩效将与你的得分相关。在十字路口：
                            </p>
                            <p>若你选择直行，对方选择左转，则两车均无法顺利通过，各得-2分；</p>
                            <p>若你选择直行，对方选择等待，则你可以顺利通过，得2分，对方得0分；</p>
                            <p>若你选择等待，对方选择左转，则对方可顺利通过，你得0分，对方得2分；</p>
                            <p>若你选择等待，对方选择等待，则会造成道路资源浪费，各得-1分。</p>
                            <p>
                                得分表如下：
                            <table class="mx-auto border-collapse border-2 border-blue-500 bg-blue-50 text-center">
                                <tbody>
                                    <tr class="bg-blue-100">
                                        <td class="border-2 border-blue-500 w-16"></td>
                                        <td class="border-2 border-blue-500 w-20">左转</td>
                                        <td class="border-2 border-blue-500 w-20">等待</td>
                                    </tr>
                                    <tr>
                                        <td class="border-2 border-blue-500 bg-blue-100">直行</td>
                                        <td class="border-2 border-blue-500">(-2,-2)</td>
                                        <td class="border-2 border-blue-500">(2,0)</td>
                                    </tr>
                                    <tr>
                                        <td class="border-2 border-blue-500 bg-blue-100">等待</td>
                                        <td class="border-2 border-blue-500">(0,2)</td>
                                        <td class="border-2 border-blue-500">(-1,-1)</td>
                                    </tr>
                                </tbody>
                            </table>
                            </p>
                        </div>
                        <div id="page-info-2" class="page m-auto hidden">
                            <h1>实验说明</h1>
                            <p>
                                实验中，实验程序中的路况界面为你驾驶的自动驾驶汽车车内显示屏界面。为控制实验变量，实验程序中将不展示路面上的其他车辆，只保留我方直行车辆及对方左转车辆。
                            </p>
                            <p>
                                我方汽车检测到的对方社会价值取向体现在决策框中，决策框出现时，你可对系统决策进行更改，若到达路口处未作出更改，则车辆按照系统决策行动。
                            </p>
                        </div>
                        <div id="page-preexp" class="page m-auto hidden">
                            <h1>预实验</h1>
                            <p>
                                为确保大家对实验的理解，现将进行预实验，预实验默认进行五轮次，如在预实验过程中遇到不解，可返回查看实验说明直至理解实验内容，点击按钮进入预实验。
                            </p>
                            <button
                                class="absolute left-1/2 bottom-12 transform -translate-x-40 w-20 h-10 bg-gray-300 rounded-lg"
                                onclick="goto('page-back')">返回</button>
                            <button id="preexp-btn"
                                class="z-50 absolute left-1/2 bottom-12 transform -translate-x-1/2 w-32 h-10 bg-gray-300 rounded-lg"
                                onclick="startPreExp()">预实验</button>
                            <button id="skip-btn"
                                class=" absolute left-1/2 bottom-12 transform translate-x-20 w-20 h-10 bg-gray-300 rounded-lg hidden"
                                onclick="goto('page-exp')">跳过</button>
                        </div>
                        <div id="page-exp" class="page m-auto hidden">
                            <h1>正式实验</h1>
                            <p>
                                如在预实验过程中遇到不解，可返回查看实验说明直至理解实验内容，点击按钮进入正式实验。
                            </p>
                            <button
                                class="absolute left-1/2 bottom-12 transform -translate-x-40 w-20 h-10 bg-gray-300 rounded-lg"
                                onclick="goto('page-back')">返回</button>
                            <button id="preexp-btn"
                                class="z-50 absolute left-1/2 bottom-12 transform -translate-x-1/2 w-32 h-10 bg-gray-300 rounded-lg"
                                onclick="startExp()">开始实验</button>
                        </div>
                        <div id="page-over" class="page m-auto hidden">
                            <h1>实验结束</h1>
                            <h2 class="text-center mb-2">最终得分：<span id="over-score">0</span></h2>
                            <p>感谢您的参与！在实验数据发送完毕前请勿关闭网页。</p>
                            <button id="send-btn"
                                class="z-50 absolute left-1/2 bottom-12 transform -translate-x-1/2 w-32 h-10 bg-gray-300 rounded-lg"
                                onclick="send()">发送数据</button>
                        </div>
                    </div>
                </div>
                <div id="render" class="absolute inset-5 bg-gray-400">
                    <canvas></canvas>
                </div>
                <div id="progress"
                    class="flex absolute left-5 top-5 z-50 transition-opacity opacity-80 hover:opacity-100 hidden">
                    <div id="prog-svg" class="h-10 w-10 transform -rotate-90">
                        <svg class="h-full w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                            <circle id="prog-pie" stroke-dasharray="30 95" stroke="white" stroke-width="30" fill="none"
                                r="15" cx="50" cy="50" />
                            <circle stroke="white" stroke-width="6" fill="none" r="30" cx="50" cy="50" />
                        </svg>
                    </div>
                    <div id="prog-text"
                        class="h-10 w-36 flex rounded-lg text-xl text-white opacity-0 transition-opacity">
                        <span class="my-auto ml-1 flex-shrink-0">组次：</span>
                        <span id="prog-set" class="my-auto">1</span>
                        <span id="prog-set-tail" class="my-auto">/15</span>
                    </div>
                </div>
                <div id="cut"
                    class="absolute inset-5 flex bg-gray-100 transition-opacity duration-200 ease-in-out opacity-0">
                    <span id="cut-text" class="m-auto text-gray-700 text-4xl">
                        Round: <span id="cut-round">1</span><span id="cut-round-tail">/20</span>
                    </span>
                </div>
                <div id="tip" class="absolute top-5 right-7 flex-col">
                    <div class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white">
                        <span class="my-auto ml-3 flex-shrink-0">轮次：</span>
                        <span id="tip-round" class="my-auto">1</span>
                        <span id="tip-round-tail" class="my-auto">/20</span>
                    </div>
                    <div class="h-10 w-36 mt-2 flex bg-gray-600 bg-opacity-50 rounded-lg text-xl text-white">
                        <span class="my-auto ml-3 flex-shrink-0">得分：</span>
                        <span id="tip-score" class="my-auto">0</span>
                    </div>
                </div>
                <div id="dialog-area" class="absolute top-2/3 bottom-5 inset-x-5 transition-all delay-200 invisible">
                    <div id="dialog" class="flex flex-col justify-center -mt-4 mb-4 mx-4 h-full py-4 px-0 overflow-hidden align-middle bg-white shadow-xl rounded-2xl 
                        transition aduration-200 ease-in-out transform scale-95 opacity-0">
                        <div id="dialog-sign"
                            class="absolute -mt-10 w-full transition duration-500 ease-in-out transform scale-95 opacity-10">
                            <!-- class="absolute -mt-1 w-full transition duration-500 ease-in-out transform scale-95 opacity-10"> -->
                            <svg id="move-sign" xmlns="http://www.w3.org/2000/svg"
                                class="h-24 w-24 mx-auto text-gray-700 transition-opacity" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
                                    d="M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z" />
                            </svg>
                            <svg id="wait-sign" xmlns="http://www.w3.org/2000/svg"
                                class="h-24 w-24 mx-auto text-gray-700 transition-opacity hidden" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
                                    d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                            </svg>
                        </div>
                        <div id="dialog-text" class="transition-opacity ease-in-out opacity-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-1" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <h3 class="text-center text-lg leading-6 text-gray-900 ">
                                检测到对方车辆为“<span id="tip-social" class="text-green-400">亲社会</span><span id="tip-self" class="text-red-400">亲自我</span><span id="tip-none">无信息</span>”<br>
                                我方车辆默认<b><span id="auto-decition-text">等待</span></b>，是否更改？
                            </h3>
                        </div>
                        <div id="dialog-btns" class="mt-3 flex w-80 mx-auto">
                            <button id="move-btn" type="button" class="mx-auto rounded-md inline-flex justify-center sm:px-8 px-6 py-1 text-lg text-blue-900
                                    transition-colors duration-200 ease-in-out bg-blue-100 hover:bg-blue-200"
                                onclick="clickMove();exp.changeStop(false);">
                                <div id="move-btn-svg" class="my-auto -ml-2 mr-2 w-6 flex hidden">
                                    <svg class="btn-doing animate-spin h-5 w-5 m-auto text-blue-500"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-50" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-100" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <svg class="btn-done h-6 w-6 m-auto text-blue-500 hidden"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                直行
                            </button>
                            <button id="wait-btn" type="button" class="mx-auto rounded-md inline-flex justify-center sm:px-8 px-6 py-1 text-lg text-blue-900
                                    transition-colors duration-200 ease-in-out bg-blue-100 hover:bg-blue-200"
                                onclick="clickWait();exp.changeStop(true);">
                                <div id="wait-btn-svg" class="my-auto -ml-2 mr-2 w-6 flex">
                                    <svg class="btn-doing animate-spin h-5 w-5 m-auto text-blue-500"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-50" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-100" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <svg class="btn-done h-6 w-6 m-auto text-blue-500 hidden"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                等待
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/lib/jquery-3.6.0.min.js"></script>
    <script src="js/lib/three.js"></script>
    <script src="js/load.js"></script>
    <script src="js/app.js"></script>
    <script src="js/data.js"></script>
    <script src="js/exp.js"></script>
    <script>
        const debug = false;
        if (debug) {
            $('#debug').removeClass('hidden');
            // toggleDialog(true);
            // $('#page-area').addClass('hidden');
        }

        function toggleDialog(open) {
            if (void 0 == open) {
                $('#dialog').toggleClass('scale-95 opacity-0 scale-100 opacity-100');
                $('#dialog-area').toggleClass('delay-200 invisible');
            } else if (open) {
                $('#dialog').removeClass('scale-95 opacity-0');
                $('#dialog').addClass('scale-100 opacity-100');
                $('#dialog-area').removeClass('delay-200 invisible');
            } else {
                $('#dialog').addClass('scale-95 opacity-0');
                $('#dialog').removeClass('scale-100 opacity-100');
                $('#dialog-area').addClass('delay-200 invisible');
            }
        }
        function clickMove() {
            $('#move-btn-svg').removeClass('hidden');
            $('#wait-btn-svg').addClass('hidden');
            $('#move-sign').removeClass('hidden');
            $('#wait-sign').addClass('hidden');
        }
        function clickWait() {
            $('#move-btn-svg').addClass('hidden');
            $('#wait-btn-svg').removeClass('hidden');
            $('#move-sign').addClass('hidden');
            $('#wait-sign').removeClass('hidden');
        }
        function toggleSign() {
            // $('#dialog-sign').toggleClass('opacity-10 scale-80 opacity-100 scale-100');
            $('#dialog-sign').toggleClass('opacity-0 scale-80 opacity-100 scale-100');
            $('#dialog-text').toggleClass('opacity-0 opacity-100');
        }
        function setScore(score) {
            $('#tip-score')[0].innerHTML = score;
        }
        function getScore() {
            return parseInt($('#tip-score')[0].innerHTML);
        }
        function addScore(val) {
            var newval = getScore() + val;
            if (val >= 0)
                $('#tip-score')[0].innerHTML += '+' + val;
            else
                $('#tip-score')[0].innerHTML += val;
            setTimeout(() => {
                setScore(newval);
            }, 2000);
        }
        function setProg(set) {
            $('#progress').removeClass('hidden');
            $('#prog-set')[0].innerHTML = set;
            var piePart = Math.round(set / 15 * 95 * 10) / 10;
            $('#prog-pie').attr('stroke-dasharray', piePart + ' 95');
        }
        function setRound(round) {
            if (round > 20) round -= 20;
            $('#tip-round')[0].innerHTML = round;
            $('#cut-round')[0].innerHTML = round;
        }
        function getRound() {
            return parseInt($('#tip-round')[0].innerHTML);
        }
        function addRound() {
            setRound(getRound() + 1);
        }

        function toggleCut(time, fn) {
            $('#cut').toggleClass('opacity-0 opacity-100');
            fn && setTimeout(fn, 300);
            if (void 0 != time)
                setTimeout(() => { $('#cut').toggleClass('opacity-0 opacity-100'); }, time);
        }
        function toggleCutTough(time) {
            $('#cut').removeClass('transition-opacity duration-200 ease-in-out ');
            $('#cut').toggleClass('opacity-0 opacity-100');
            setTimeout(() => { $('#cut').addClass('transition-opacity duration-200 ease-in-out '); }, 10);
            if (void 0 != time)
                setTimeout(() => { $('#cut').toggleClass('opacity-0 opacity-100'); }, time);
        }


        function togglePage(page) {
            if (void 0 != page) {
                $('#skip-btn').removeClass('hidden');
                $('#page-' + currentPage).addClass('hidden');
                currentPage = page;
                next();
            }
            $('#page').toggleClass('opacity-0 opacity-100 invisible');
        }

        var currPage = 0;
        $('.page:eq(' + currPage + ')').removeClass('hidden');
        function next(addPage) {
            if (currPage==0){
                if ($('#id-input')[0].value){
                    data.setID($('#id-input')[0].value);
                }
                else if(!debug){
                    window.alert("请输入实验编号！");
                    return;
                }
            }
            if (void 0 != addPage) {
                currPage += addPage;
            } else {
                currPage++;
            }
            goto(currPage);
        }
        function back(subPage) {
            if (void 0 != subPage) {
                currPage -= subPage;
            } else {
                currPage--;
            }
            goto(currPage);
        }
        function goto(page) {
            $('.page').addClass('hidden');
            if (typeof (page) == 'number') {
                currPage = page;
            }
            else {
                var tempPage = -1;
                $('.page').each(function () {
                    tempPage++;
                    return !$(this).is('#' + page);
                });
                currPage = tempPage;
            }
            $('.page:eq(' + currPage + ')').removeClass('hidden');
        }

        function startPreExp() {
            $('#page-area').addClass('hidden');
            $('#page-area').toggleClass('opacity-0 opacity-100');
            toggleCutTough(1000);
            app.pause();
            app.reset();
            app.setSelf(40);
            app.setOther();
            exp.startPreExp(5);
        }
        function endPreExp() {
            app.pause();
            $('#page-area').removeClass('hidden');
            $('#skip-btn').removeClass('hidden');
            setTimeout(() => {
                $('#page-area').toggleClass('opacity-0 opacity-100');
            }, 100);
            next();
        }
        function startExp() {
            $('#page-area').addClass('opacity-0 hidden');
            $('#page-area').removeClass('opacity-100');
            toggleCutTough(1000);
            app.pause();
            app.reset();
            app.setSelf(40);
            app.setOther();
            exp.startExp();
        }
        function endExp(score) {
            $('#over-score')[0].innerHTML = score;
            endPreExp();
            data.setSVO();
            data.setScore(score);
            data.sendData();
        }
        app.pause();
    </script>
</body>

</html>